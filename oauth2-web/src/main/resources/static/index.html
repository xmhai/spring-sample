<!DOCTYPE html>
<html>
<head>
  <title>JWT Authentication Example</title>
</head>
<body>
  <h1>Welcome to the JWT Authentication Example</h1>
  
  <script>
    const parsedHash = new URLSearchParams(
      window.location.hash.substring(1) // skip the first char (#)
    );

	var token = parsedHash.get("token");
    console.log(token);
	if (token) {
	    // Store the JWT in local storage
	    localStorage.setItem('jwt', token);
	    console.log('token saved');
	} 
      
    // Check if the user is authenticated on page load
    const jwt = localStorage.getItem('jwt');
    console.log(jwt);
    if (jwt) {
      // login user, redirect to resource page (no possible to do a redirection with header set)
      fetch('http://localhost:8082/api/userinfo', {
        headers: {
          'Authorization': `Bearer ${jwt}`
        }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Authentication failed');
        }
        return response.json();
      })
      .then(data => {
	    console.log(data);
		node = document.createTextNode(JSON.stringify(data));
		div = document.createElement("div");
		div.appendChild(node);
		document.body.appendChild(div);      
      })
      .catch(error => {
        console.error(error);
        alert('Authentication failed');
      });      
    } else {
      // not login
      window.location.replace("http://localhost:8081/login");
    }
  </script>
</body>
</html>
